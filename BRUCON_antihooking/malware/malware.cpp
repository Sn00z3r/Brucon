// malware.cpp : Defines the entry point for the console application.
//
#include "stdafx.h"
#include "malware.h"
#include "Unhook.h"

int main()
{
	HMODULE hmodule = LoadLibraryA("anti-malware.dll");
	initHook _initHook = (initHook)GetProcAddress(hmodule, "initHook");
	if (_initHook == NULL) {
	}
	else {
		PVOID address = _initHook();
	
	}

	

	printf("*** Anti-malware module Loaded!\n*** Forbidden functions: NtCreateUserProcess\n\n");
	printf("# Welcome to MalwareBonanza v2.0\n# Press enter to continue\n");
	cin.get();
	UnHook();
	printf("\n# Trying to call NtCreateUserProcess through CreateProcessA, I don't believe the anti-malware\n");
	PROCESS_INFORMATION ProcessInfo; //This is what we get as an [out] parameter

	STARTUPINFOA StartupInfo; //This is an [in] parameter
	ZeroMemory(&StartupInfo, sizeof(StartupInfo));
	StartupInfo.cb = sizeof StartupInfo; //Only compulsory field
	CreateProcessA("c:\\windows\\system32\\notepad.exe", NULL,NULL, NULL, FALSE, 0, NULL,NULL, &StartupInfo, &ProcessInfo);
    return 0;
}